<section>
<% if @project %>
	<%= render :partial => 'projects/titlebar' -%>
	<% if last_indexed_at = @project.last_indexed_at %>
		<div class="note">
			RDFization last created at <%= last_indexed_at %>, (EP: <%= @project.last_indexed_at_live || '-'%>)
			<% if @project.editable?(current_user) -%>
				&nbsp;<%= link_to 'Delete', delete_annotation_rdf_project_path(@project.name), method: :delete, data: { confirm: 'Are you sure?' }, class: 'button' %>
			<% end %>
		</div>
	<% else %>
		<div class="note">The project is not yet RDFized.</div>
	<% end %>
<% end %>

<h1>
Search
<a href="#help-maintainer" rel="facebox"><i class="help-link fa fa-question-circle" aria-hidden="true"></i></a>
</h1>

<p class="note">It is now a beta feature, which is still under development. Please understand that sometimes this feature may work unstably. Your comments or reports on bugs will be highly appreciated.</p>

<div id="help-maintainer" class="help">
  <h1>Search</h1>
  <p>
	In the search page, you can search the RDFized annotations in PubAnnotation using
	<%= link_to 'SPARQL', 'https://www.w3.org/TR/sparql11-query/' %>.
	If not familiar with
	<%= link_to 'SPARQL', 'https://www.w3.org/TR/sparql11-query/' %>,
	you are recommended to try with the predefined templates.
	<% unless @project %>
	If you go to a specific project, you can find more templates specific to the project.
	<% end %>
	</p>
</div>

<% if @message %>
<pre style="border:2px solid #ff8888 ;padding:8px 4px; background-color:#ffdddd">
<%= @message[:message] %>
</pre>
<% end %>
<%= render "query_in_sparql" %>

<% if @solutions %>
	<%= render :partial => 'shared/textae_css_js'-%>
	<section>
		<h1>Result spans rendered in <a href="http://textae.pubannotation.org">TextAE</a></h1>
		<%= render "page_index" %>
		<% color_coding = nil %>
		<% @solutions["results"]["bindings"].each do |solution| %>
			<%
				projects = params[:projects].split(',')
				span_url = solution2span_url(solution)
				annotations = span_url2annotations(span_url, projects)
				color_coding ||= Annotation.generate_source_project_color_coding(annotations)
				Annotation.add_source_project_color_coding!(annotations, color_coding)
			%>

			<%= content_tag(:div, annotations.to_json, class: "textae-editor", status_bar: "off", style:"margin:2px 0 0 0") %>
			<%= link_to ">PubAnnotation", span_url, class: "button" %>
		<% end %>
	</section>
<% end %>
