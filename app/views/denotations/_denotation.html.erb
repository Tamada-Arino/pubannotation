<% collection_size = local_assigns[:size].present? ? local_assigns[:size] : @denotations.size-%>

<%
  if params[:sourcedb].present? && params[:sourceid].present? && params[:begin].present? && params[:end].present?
    if params[:div_id].present?
      @textae_json_url = spans_annotations_project_sourcedb_sourceid_divs_docs_url(project.name, params[:sourcedb], params[:sourceid], params[:div_id], params[:begin], params[:end])
    else
      @textae_json_url = spans_annotations_project_sourcedb_sourceid_docs_url(project.name, params[:sourcedb], params[:sourceid], params[:begin], params[:end])
    end
    @textae_json_url += '.json'
  end
-%>
<%= render partial: 'shared/textae_div', locals: {target_json_url: @textae_json_url} if @textae_json_url.present? -%>

<% if denotation_counter == 0 -%>
  <% if local_assigns[:project].present? -%>
    <h2><%= project.name -%></h2>
  <% end %>
  <strong><%= t('activerecord.models.denotation') %></strong>
  <table class="ann">
    <tr>
      <% if local_assigns[:project].present? -%>
      	<th>Project</th>
      <% end -%>
      <th>Id</th>
      <th>Span</th>
      <th>Predicate</th>
      <th>Object</th>
    </tr>
<% end %>

<tr>
  <% if local_assigns[:project].present? && denotation_counter == 0 -%>
  	<td rowspan="<%= collection_size -%>" style="vertical-align: top">
      <%= link_to project.name, project_path(project.name) -%>
    </td>
  <% end -%>
  <td><%= denotation[:id] %></td>
  <td>
    <% unless denotation[:span].respond_to?(:keys) %>
      <% denotation[:span].each_with_index do |s, i| %><% unless i == 0 %>,<% end %><%= s[:begin] %>:<%= s[:end] %><% end %>
    <% else %>
        <%= spans_link_helper(@doc, denotation) -%>
    <% end %>
  </td>
  <td>denote</td>
  <td><%= denotation[:obj] %></td>
  <% if @doc.present? -%>
      <td class="spans_preview">
  		<%= @doc.body[denotation[:span][:begin]...denotation[:span][:end]] -%>
      </td>
  <% end %> 
</tr>

<% if denotation_counter == collection_size - 1 -%>
  </table>
<% end -%>
