<% content_for :path do %>
    > <%= link_to t('views.paths.home'), home_path %>
    <% if @doc and @doc.sourcedb == 'PubMed' %>
        > <%= link_to t('views.shared.pmdocs'), pmdocs_path %>
        > <%= link_to @doc.sourceid, pmdoc_path(@doc.sourceid) %>
        > <%= link_to t('activerecord.models.project').pluralize, pmdoc_projects_path(@doc.sourceid) %>
    <% elsif @doc and @doc.sourcedb == 'PMC' %>
        > <%= link_to t('views.shared.pmcdocs'), pmcdocs_path %>
        > <%= link_to @doc.sourceid, pmcdoc_path(@doc.sourceid) %>
        > <%= link_to t('views.shared.divs'),    pmcdoc_divs_path(@doc.sourceid) %>
        > <%= link_to @doc.serial,   pmcdoc_div_path(@doc.sourceid, @doc.serial) %>
        > <%= link_to t('activerecord.models.project').pluralize, pmcdoc_div_projects_path(@doc.sourceid, @doc.serial) %>
    <% else %>
        > <%= link_to t('activerecord.models.project').pluralize, projects_path %>
    <% end %>
  > <%= link_to @project.name, project_path(@project.name) %>
  > <%= t('activerecord.models.notice') -%>
<% end %>

<%= render :partial => 'projects/title_and_links' -%>

<h1>Background tasks
<%= link_to 'Clear finished jobs', project_clear_jobs_path(@project.name), method: :delete, :class => :button %>
</h1>

<table>
  <tr>
    <th>Id.</th>
    <th>Name</th>
    <th>Create at</th>
    <th>State</th>
    <th>Progress</th>
    <th># Messages</th>
    <th></th>
    <th></th>
  </tr>

<% @jobs.each do |job| %>
  <tr>
    <td><%= job.delayed_job_id %></td>
    <td><%= job.name %></td>
    <td><%= job.created_at %></td>
    <td><%= state(job) %></td>
    <td style="text-align:right"><%= job.num_dones %> / <%= job.num_items %></td>
    <td style="text-align:right"><%= job.messages.length %></td>
    <td><%= link_to 'Show', project_job_path(@project.name, job) %></td>
    <td><%= link_to 'Destroy', project_job_path(@project.name, job), method: :delete, data: { confirm: 'Are you sure?' } %></td>
  </tr>
<% end %>
</table>
