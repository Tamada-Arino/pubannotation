<section>
<% if @project %>
	<%= render :partial => 'projects/titlebar' -%>
	<% if @project_last_indexed_at %>
		<div class="note">RDFization last updated at <%= @project_last_indexed_at %></div>
	<% else %>
		<div class="note">The project is not yet RDFized.</div>
	<% end %>
<% end %>

<h1>
Search
<a href="#help-maintainer" rel="facebox"><i class="help-link fa fa-question-circle" aria-hidden="true"></i></a>
</h1>

<p class="note">It is now a beta feature, which is still under development. Please understand that sometimes this feature may work unstably. Your comments or reports on bugs will be highly appreciated.</p>

<div id="help-maintainer" class="help">
  <h1>Search</h1>
  <p>
	In the search page, you can search the RDFized annotations in PubAnnotation using
	<%= link_to 'SPARQL', 'https://www.w3.org/TR/sparql11-query/' %>.
	If not familiar with
	<%= link_to 'SPARQL', 'https://www.w3.org/TR/sparql11-query/' %>,
	you are recommended to try with the predefined templates.
	<% unless @project %>
	If you go to a specific project, you can find more templates specific to the project.
	<% end %>
	</p>
</div>

<p class="note">
</p>

<% if @message %>
<pre style="background-color: #ffdddd">
<%= @message[:message] %>
</pre>
<% end %>
<%= render "query_in_sparql" %>

<% if @solutions %>
	<section>
		<h2>Results</h2>

		<div class="page_info">
			<span>&nbsp;</span>
			<span class="num_solutions"><%= @num_solutions %> results</span>
		</div>
		<table style="table-layout:fixed; width:100%">
			<tr>
				<% @solutions["head"]["vars"].each do |h| %>
				<th><%= h %></th>
				<% end %>
			</tr>

			<% @solutions["results"]["bindings"].each do |binding| %>
				<tr>
					<% binding.each_value do |v| %>
						<td><%= v["type"] == "uri" ? link_to(v["value"], v["value"]) : v["value"] %></td>
					<% end %>
				</tr>
			<% end %>
		</table>
	</section>
<% end %>
